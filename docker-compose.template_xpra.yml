# ###########################################################################
# Docker Compose XPRA Overlay Template for ROS Projects
#
# Template file for adding browser-based RViz visualization via XPRA HTML5
# to existing ROS Docker Compose projects.
#
# @author      James R. Heselden (github: iranaphor)
# @maintainer  James R. Heselden (github: iranaphor)
# @datecreated 30th November 2025
# @credits     Code structure and implementation were developed by the
#              author with assistance from Anthropic's Claude Sonnet 4.5
#              model via GitHub Copilot, used under the author's direction
#              and supervision.
#
###########################################################################

services:
  rviz-xpra:
    build: ./rviz-xpra
    ports:
      - "14500:14500"
    network_mode: host  # Change to match your prod service network mode
    volumes:
      - rviz_config:/root/.rviz2
      - fleet_rviz_config:/fleet_config:ro
    environment:
      - ROS_DOMAIN_ID=0  # Change to match your ROS_DOMAIN_ID
    command: >
      bash -c "source /opt/ros/humble/setup.bash &&
      exec xpra start :100
      --bind-tcp=0.0.0.0:14500
      --html=on
      --start-child='rviz2 -d /fleet_config/your_config.rviz'
      --exit-with-children
      --daemon=no
      --pulseaudio=no
      --notifications=no
      --bell=no
      --mdns=no"

  your_ros_service:  # CHANGE THIS to your actual service name
    container_name:  # Remove if your service doesn't use container_name
    volumes:
      - fleet_rviz_config:/path/to/your/rviz/config  # CHANGE THIS to your RViz config directory
    environment:
      - ENABLE_RVIZ=false  # Optional: disable built-in RViz if your service has one

volumes:
  rviz_config:
  fleet_rviz_config:
  colcon_cache:  # Add any other volumes your prod service uses
